const f=(t,l)=>{t.attrs=(t.attrs||[]).filter(([e])=>e!==l)},d=t=>{var l,e;const i=(e=(l=t.attrs)==null?void 0:l.find(([o])=>o==="title"))==null?void 0:e[1];return i?(f(t,"title"),i):t.content},u=(t,l={})=>{t.core.ruler.before("linkify","figure",e=>{for(let i=1,{length:o}=e.tokens;i<o-1;i++){const n=e.tokens[i];if(n.type!=="inline"||!n.children||n.children.length!==1&&n.children.length!==3||n.children.length===1&&n.children[0].type!=="image")continue;if(n.children.length===3){const[p,g,a]=n.children;if(p.type!=="link_open"||g.type!=="image"||a.type!=="link_close")continue}if(i!==0&&e.tokens[i-1].type!=="paragraph_open"||i!==o-1&&e.tokens[i+1].type!=="paragraph_close")continue;const r=e.tokens[i-1];r.type="figure_open",r.tag="figure",e.tokens[i+1].type="figure_close",e.tokens[i+1].tag="figure";const c=n.children.length===1?n.children[0]:n.children[1],s=d(c),[h]=t.parseInline(s,e.env);n.children.push(new e.Token("figcaption_open","figcaption",1)),n.children.push(...h.children||[]),n.children.push(new e.Token("figcaption_close","figcaption",-1)),l.focusable!==!1&&c.attrPush(["tabindex","0"])}})};export{u as figure};
//# sourceMappingURL=index.mjs.map
