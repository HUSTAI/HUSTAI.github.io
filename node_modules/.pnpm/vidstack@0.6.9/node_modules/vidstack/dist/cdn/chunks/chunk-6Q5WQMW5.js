import { f as f$1 } from './chunk-Q6MEJHLE.js';

var C=/\r?\n|\r/gm,$=class{constructor(t){let e=new O(t);this.writable=new WritableStream({write(i){e.transform(i);},close(){e.close();}}),this.readable=new ReadableStream({start(i){e.onLine=n=>i.enqueue(n),e.onClose=()=>i.close();}});}},O=class{constructor(t){this.n="",this.C=new TextDecoder(t);}transform(t){this.n+=this.C.decode(t,{stream:!0});let e=this.n.split(C);this.n=e.pop()||"";for(let i=0;i<e.length;i++)this.onLine(e[i].trim());}close(){this.n&&this.onLine(this.n.trim()),this.n="",this.onClose();}};async function ut(t,e){let i=new ReadableStream({start(n){let r=t.split(C);for(let s of r)n.enqueue(s);n.close();}});return S(i,e)}async function S(t,e){let i=e?.type??"vtt",n;if(typeof i=="string")switch(i){case"srt":n=(await import('./parse-3ID7YS64-WRHLTHTE.js')).default;break;case"ssa":case"ass":n=(await import('./parse-MHXWKG3Q-NOFR6365.js')).default;break;default:n=(await import('./parse-F44NSPYQ-N4G5MDW4.js')).default;}else n=i;let r,s=t.getReader(),o=n(),a=!!e?.strict||!!e?.errors;await o.init({strict:!1,...e,errors:a,type:i,cancel(){s.cancel(),r=o.done(!0);}});let l=1;for(;;){let{value:h,done:c}=await s.read();if(c){o.parse("",l),r=o.done(!1);break}o.parse(h,l),l++;}return r}async function dt(t,e){let i=await t;if(!i.ok||!i.body){let o;return {metadata:{},cues:[],regions:[],errors:[o]}}let n=i.headers.get("content-type")||"",r=n.match(/text\/(.*?)(?:;|$)/)?.[1],s=n.match(/charset=(.*?)(?:;|$)/)?.[1];return E(i.body,{type:r,encoding:s,...e})}async function E(t,{encoding:e="utf-8",...i}={}){let n=t.pipeThrough(new $(e));return S(n,i)}var _=/[0-9]/,P=/[\s\t]+/,k={c:"span",i:"i",b:"b",u:"u",ruby:"ruby",rt:"rt",v:"span",lang:"span",timestamp:"span"},z={"&amp;":"&","&lt;":"<","&gt;":">","&quot;":'"',"&#39;":"'","&nbsp;":"\xA0","&lrm;":"\u200E","&rlm;":"\u200F"},V=/&(?:amp|lt|gt|quot|#(0+)?39|nbsp|lrm|rlm);/g,q=new Set(["white","lime","cyan","red","yellow","magenta","blue","black"]),H=new Set(Object.keys(k));function W(t){let e="",i=1,n=[],r=[],s;for(let h=0;h<t.text.length;h++){let c=t.text[h];switch(i){case 1:c==="<"?(l(),i=2):e+=c;break;case 2:switch(c){case`
`:case"	":case" ":o(),i=4;break;case".":o(),i=3;break;case"/":i=5;break;case">":o(),i=1;break;default:!e&&_.test(c)&&(i=6),e+=c;break}break;case 3:switch(c){case"	":case" ":case`
`:a(),s&&s.class?.trim(),i=4;break;case".":a();break;case">":a(),s&&s.class?.trim(),i=1;break;default:e+=c;}break;case 4:c===">"?(e=e.replace(P," "),s?.type==="v"?s.voice=T(e):s?.type==="lang"&&(s.lang=T(e)),e="",i=1):e+=c;break;case 5:c===">"&&(e="",s=r.pop(),i=1);break;case 6:if(c===">"){let m=f$1(e);m!==null&&m>=t.startTime&&m<=t.endTime&&(e="timestamp",o(),s.time=m),e="",i=1;}else e+=c;break}}function o(){if(H.has(e)){let h=s;s=X(e),h?(r[r.length-1]!==h&&r.push(h),h.children.push(s)):n.push(s);}e="",i=1;}function a(){if(s&&e){let h=e.replace("bg_","");q.has(h)?s[e.startsWith("bg_")?"bgColor":"color"]=h:s.class=s.class?s.class+" "+e:e;}e="";}function l(){if(!e)return;let h={type:"text",data:T(e)};s?s.children.push(h):n.push(h),e="";}return i===1&&l(),n}function X(t){return {tagName:k[t],type:t,children:[]}}function T(t){return t.replace(V,e=>z[e]||"'")}function f(t,e,i){t.style.setProperty(`--${e}`,i+"");}function u(t,e,i=!0){t.setAttribute(`data-${e}`,i===!0?"":i+"");}function g(t,e){t.setAttribute("part",e);}function D(t){return parseFloat(getComputedStyle(t).lineHeight)||0}function mt(t){let e=document.createElement("template");return e.innerHTML=B(t),{cue:t,content:e.content}}function B(t,e=0){return R(W(t),e)}function R(t,e=0){let i,n="";for(let r of t)if(r.type==="text")n+=r.data;else {let s=r.type==="timestamp";i={},i.class=r.class,i.title=r.type==="v"&&r.voice,i.lang=r.type==="lang"&&r.lang,i.part=r.type==="v"&&"voice",s&&(i.part="timed",i["data-time"]=r.time,i["data-future"]=r.time>e,i["data-past"]=r.time<e),i.style=`${r.color?`color: ${r.color};`:""}${r.bgColor?`background-color: ${r.bgColor};`:""}`;let o=Object.entries(i).filter(a=>a[1]).map(a=>`${a[0]}="${a[1]===!0?"":a[1]}"`).join(" ");n+=`<${r.tagName}${o?" "+o:""}>${R(r.children)}</${r.tagName}>`;}return n}function Y(t,e){for(let i of t.querySelectorAll('[part="timed"]')){let n=Number(i.getAttribute("data-time"));Number.isNaN(n)||(n>e?u(i,"future"):i.removeAttribute("data-future"),n<e?u(i,"past"):i.removeAttribute("data-past"));}}function F(t,e){let i=null,n;function r(){s(),t(...n),n=void 0;}function s(){clearTimeout(i),i=null;}function o(){n=[].slice.call(arguments),s(),i=setTimeout(r,e);}return o}var d=Symbol(0);function v(t){return t instanceof HTMLElement?{top:t.offsetTop,width:t.clientWidth,height:t.clientHeight,left:t.offsetLeft,right:t.offsetLeft+t.clientWidth,bottom:t.offsetTop+t.clientHeight}:{...t}}function y(t,e,i){switch(e){case"+x":t.left+=i,t.right+=i;break;case"-x":t.left-=i,t.right-=i;break;case"+y":t.top+=i,t.bottom+=i;break;case"-y":t.top-=i,t.bottom-=i;break}}function G(t,e){return t.left<=e.right&&t.right>=e.left&&t.top<=e.bottom&&t.bottom>=e.top}function j(t,e){for(let i=0;i<e.length;i++)if(G(t,e[i]))return e[i];return null}function A(t,e){return e.top>=0&&e.bottom<=t.height&&e.left>=0&&e.right<=t.width}function Z(t,e,i){switch(i){case"+x":return e.left<0;case"-x":return e.right>t.width;case"+y":return e.top<0;case"-y":return e.bottom>t.height}}function K(t,e){let i=Math.max(0,Math.min(t.width,e.right)-Math.max(0,e.left)),n=Math.max(0,Math.min(t.height,e.bottom)-Math.max(0,e.top));return i*n/(t.height*t.width)}function w(t,e){return {top:e.top/t.height,left:e.left/t.width,right:(t.width-e.right)/t.width,bottom:(t.height-e.bottom)/t.height}}function M(t,e){return e.top=e.top*t.height,e.left=e.left*t.width,e.right=t.width-e.right*t.width,e.bottom=t.height-e.bottom*t.height,e}var N=["top","left","right","bottom"];function L(t,e,i,n){let r=w(e,i);for(let s of N)f(t,`${n}-${s}`,r[s]*100+"%");}function x(t,e,i,n){let r=1,s,o={...e};for(let a=0;a<n.length;a++){for(;Z(t,e,n[a])||A(t,e)&&j(e,i);)y(e,n[a],1);if(A(t,e))return e;let l=K(t,e);r>l&&(s={...e},r=l),e={...o};}return s||o}var p=Symbol(0);function J(t,e,i,n){let r=i.firstElementChild,s=tt(e),o,a=[];if(i[d]||(i[d]=Q(t,i)),o=M(t,{...i[d]}),i[p])a=[i[p]==="top"?"+y":"-y","+x","-x"];else if(e.snapToLines){let l;switch(e.vertical){case"":a=["+y","-y"],l="height";break;case"rl":a=["+x","-x"],l="width";break;case"lr":a=["-x","+x"],l="width";break}let h=D(r),c=h*Math.round(s),m=t[l]+h,I=a[0];Math.abs(c)>m&&(c=c<0?-1:1,c*=Math.ceil(m/h)*h),s<0&&(c+=e.vertical===""?t.height:t.width,a=a.reverse()),y(o,I,c);}else {let l=e.vertical==="",h=l?"+y":"+x",c=l?o.height:o.width;y(o,h,(l?t.height:t.width)*s/100),y(o,h,e.lineAlign==="center"?c/2:e.lineAlign==="end"?c:0),a=l?["-y","+y","-x","+x"]:["-x","+x","-y","+y"];}return o=x(t,o,n,a),L(i,t,o,"cue"),o}function Q(t,e){let i=v(e),n=U(e);if(e[p]=!1,n.top&&(i.top=n.top,i.bottom=n.top+i.height,e[p]="top"),n.bottom){let r=t.height-n.bottom;i.top=r-i.height,i.bottom=r,e[p]="bottom";}return n.left&&(i.left=n.left),n.right&&(i.right=t.width-n.right),w(t,i)}function U(t){let e={};for(let i of N)e[i]=parseFloat(t.style.getPropertyValue(`--cue-${i}`));return e}function tt(t){return t.line==="auto"?t.snapToLines?-1:100:t.line}function et(t){if(t.position==="auto")switch(t.align){case"start":case"left":return 0;case"right":case"end":return 100;default:return 50}return t.position}function it(t,e){if(t.positionAlign==="auto")switch(t.align){case"start":return e==="ltr"?"line-left":"line-right";case"end":return e==="ltr"?"line-right":"line-left";case"center":return "center";default:return `line-${t.align}`}return t.positionAlign}var rt=["-y","+y","-x","+x"];function st(t,e,i,n){let r=Array.from(i.querySelectorAll('[part="cue-display"]')),s=0,o=Math.max(0,r.length-e.lines);for(let l=r.length-1;l>=o;l--)s+=r[l].offsetHeight;f(i,"region-height",s+"px"),i[d]||(i[d]=w(t,v(i)));let a={...i[d]};return a=M(t,a),a.width=i.clientWidth,a.height=s,a.right=a.left+a.width,a.bottom=a.top+s,a=x(t,a,n,rt),L(i,t,a,"region"),a}var pt=class{constructor(t,e){this.r=0,this.y="ltr",this.t=[],this.z=!1,this.l=new Map,this.d=new Map,this.Y=F(()=>{this.z=!1,this.M();for(let i of this.l.values())i[d]=null;for(let i of this.d.values())i&&(i[d]=null);this.N(!0);},50),this.overlay=t,this.dir=e?.dir??"ltr",t.setAttribute("translate","yes"),t.setAttribute("aria-live","off"),t.setAttribute("aria-atomic","true"),g(t,"captions"),this.M(),this.A=new ResizeObserver(this.W.bind(this)),this.A.observe(t);}get dir(){return this.y}set dir(t){this.y=t,u(this.overlay,"dir",t);}get currentTime(){return this.r}set currentTime(t){this.r=t,this.update();}changeTrack({regions:t,cues:e}){this.reset(),this.X(t);for(let i of e)this.d.set(i,null);this.update();}addCue(t){this.d.set(t,null),this.update();}removeCue(t){this.d.delete(t),this.update();}update(t=!1){this.N(t);}reset(){this.d.clear(),this.l.clear(),this.t=[],this.overlay.textContent="";}destroy(){this.reset(),this.A.disconnect();}W(){this.z=!0,this.Y();}M(){this.q=v(this.overlay),f(this.overlay,"overlay-width",this.q.width+"px"),f(this.overlay,"overlay-height",this.q.height+"px");}N(t=!1){if(!this.d.size||this.z)return;let e,i=[...this.d.keys()].filter(r=>this.r>=r.startTime&&this.r<=r.endTime).sort((r,s)=>r.startTime!==s.startTime?r.startTime-s.startTime:r.endTime-s.endTime),n=i.map(r=>r.region);for(let r=0;r<this.t.length;r++){if(e=this.t[r],i[r]===e)continue;if(e.region&&!n.includes(e.region)){let o=this.l.get(e.region.id);o&&(o.removeAttribute("data-active"),t=!0);}let s=this.d.get(e);s&&(s.remove(),t=!0);}for(let r=0;r<i.length;r++){e=i[r];let s=this.d.get(e);s||this.d.set(e,s=this.Z(e));let o=this.B(e)&&this.l.get(e.region.id);o&&!o.hasAttribute("data-active")&&(requestAnimationFrame(()=>u(o,"active")),t=!0),s.isConnected||((o||this.overlay).append(s),t=!0);}if(t){let r=[],s=new Set;for(let o=i.length-1;o>=0;o--){if(e=i[o],s.has(e.region||e))continue;let a=this.B(e),l=a?this.l.get(e.region.id):this.d.get(e);a?r.push(st(this.q,e.region,l,r)):r.push(J(this.q,e,l,r)),s.add(a?e.region:e);}}Y(this.overlay,this.r),this.t=i;}X(t){if(t)for(let e of t){let i=this.is(e);this.l.set(e.id,i),this.overlay.append(i);}}is(t){let e=document.createElement("div");return g(e,"region"),u(e,"id",t.id),u(e,"scroll",t.scroll),f(e,"region-width",t.width+"%"),f(e,"region-anchor-x",t.regionAnchorX),f(e,"region-anchor-y",t.regionAnchorY),f(e,"region-viewport-anchor-x",t.viewportAnchorX),f(e,"region-viewport-anchor-y",t.viewportAnchorY),f(e,"region-lines",t.lines),e}Z(t){let e=document.createElement("div"),i=et(t),n=it(t,this.y);if(g(e,"cue-display"),t.vertical!==""&&u(e,"vertical"),f(e,"cue-text-align",t.align),t.style)for(let s of Object.keys(t.style))e.style.setProperty(s,t.style[s]);if(this.B(t))f(e,"cue-offset",`${i-(n==="line-right"?100:n==="center"?50:0)}%`);else if(f(e,"cue-writing-mode",t.vertical===""?"horizontal-tb":t.vertical==="lr"?"vertical-lr":"vertical-rl"),!t.style?.["--cue-width"]){let s=i;n==="line-left"?s=100-i:n==="center"&&i<=50?s=i*2:n==="center"&&i>50&&(s=(100-i)*2);let o=t.size<s?t.size:s;t.vertical===""?f(e,"cue-width",o+"%"):f(e,"cue-height",o+"%");}let r=document.createElement("div");return g(r,"cue"),t.id&&u(r,"id",t.id),r.innerHTML=B(t),e.append(r),e}B(t){return t.region&&t.size===100&&t.vertical===""&&t.line==="auto"}};

export { ut as a, S as b, dt as c, E as d, W as e, mt as f, B as g, R as h, Y as i, pt as j };
