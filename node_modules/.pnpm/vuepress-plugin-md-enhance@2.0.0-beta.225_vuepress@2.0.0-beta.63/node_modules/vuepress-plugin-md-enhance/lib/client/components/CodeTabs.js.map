{"version":3,"file":"CodeTabs.js","sources":["../../../src/client/components/CodeTabs.ts"],"sourcesContent":["import { useStorage } from \"@vueuse/core\";\nimport type { PropType, SlotsType, VNode } from \"vue\";\nimport { defineComponent, h, onMounted, ref, shallowRef, watch } from \"vue\";\n\nimport type { TabProps } from \"./Tabs.js\";\n\nimport \"../styles/code-tabs.scss\";\n\nconst codeTabStore = useStorage<Record<string, string>>(\n  \"VUEPRESS_CODE_TAB_STORE\",\n  {}\n);\n\nexport default defineComponent({\n  name: \"CodeTabs\",\n\n  props: {\n    /**\n     * Active tab index\n     *\n     * 激活的标签页序号\n     */\n    active: {\n      type: Number,\n      default: 0,\n    },\n\n    /**\n     * Code tab data\n     *\n     * 代码标签页数据\n     */\n    data: {\n      type: Array as PropType<TabProps[]>,\n      required: true,\n    },\n\n    /**\n     * Code tab id\n     *\n     * 代码标签页 id\n     */\n    id: {\n      type: String,\n      required: true,\n    },\n\n    /**\n     * tab id\n     *\n     * 标签页 id\n     */\n    tabId: {\n      type: String,\n      default: \"\",\n    },\n  },\n\n  slots: Object as SlotsType<{\n    [slot: `title${number}`]: (props: {\n      value: string;\n      isActive: boolean;\n    }) => VNode[];\n    [slot: `tab${number}`]: (props: {\n      value: string;\n      isActive: boolean;\n    }) => VNode[];\n  }>,\n\n  setup(props, { slots }) {\n    // index of current active item\n    const activeIndex = ref(props.active);\n\n    // refs of the tab buttons\n    const tabRefs = shallowRef<HTMLUListElement[]>([]);\n\n    // update store\n    const updateStore = (): void => {\n      if (props.tabId)\n        codeTabStore.value[props.tabId] = props.data[activeIndex.value].id;\n    };\n\n    // activate next tab\n    const activateNext = (index = activeIndex.value): void => {\n      activeIndex.value = index < tabRefs.value.length - 1 ? index + 1 : 0;\n      tabRefs.value[activeIndex.value].focus();\n    };\n\n    // activate previous tab\n    const activatePrev = (index = activeIndex.value): void => {\n      activeIndex.value = index > 0 ? index - 1 : tabRefs.value.length - 1;\n      tabRefs.value[activeIndex.value].focus();\n    };\n\n    // handle keyboard event\n    const keyboardHandler = (event: KeyboardEvent, index: number): void => {\n      if (event.key === \" \" || event.key === \"Enter\") {\n        event.preventDefault();\n        activeIndex.value = index;\n      } else if (event.key === \"ArrowRight\") {\n        event.preventDefault();\n        activateNext();\n      } else if (event.key === \"ArrowLeft\") {\n        event.preventDefault();\n        activatePrev();\n      }\n\n      if (props.tabId)\n        codeTabStore.value[props.tabId] = props.data[activeIndex.value].id;\n    };\n\n    const getInitialIndex = (): number => {\n      if (props.tabId) {\n        const valueIndex = props.data.findIndex(\n          ({ id }) => codeTabStore.value[props.tabId] === id\n        );\n\n        if (valueIndex !== -1) return valueIndex;\n      }\n\n      return props.active;\n    };\n\n    onMounted(() => {\n      activeIndex.value = getInitialIndex();\n\n      watch(\n        () => codeTabStore.value[props.tabId],\n        (newValue, oldValue) => {\n          if (props.tabId && newValue !== oldValue) {\n            const index = props.data.findIndex(({ id }) => id === newValue);\n\n            if (index !== -1) activeIndex.value = index;\n          }\n        }\n      );\n    });\n\n    return (): VNode | null =>\n      props.data.length\n        ? h(\"div\", { class: \"vp-code-tabs\" }, [\n            h(\n              \"div\",\n              { class: \"vp-code-tabs-nav\", role: \"tablist\" },\n              props.data.map(({ id }, index) => {\n                const isActive = index === activeIndex.value;\n\n                return h(\n                  \"button\",\n                  {\n                    type: \"button\",\n                    ref: (element) => {\n                      if (element)\n                        tabRefs.value[index] = <HTMLUListElement>element;\n                    },\n                    class: [\"vp-code-tab-nav\", { active: isActive }],\n                    role: \"tab\",\n                    \"aria-controls\": `codetab-${props.id}-${index}`,\n                    \"aria-selected\": isActive,\n                    onClick: () => {\n                      activeIndex.value = index;\n                      updateStore();\n                    },\n                    onKeydown: (event: KeyboardEvent) =>\n                      keyboardHandler(event, index),\n                  },\n                  slots[`title${index}`]({ value: id, isActive })\n                );\n              })\n            ),\n            props.data.map(({ id }, index) => {\n              const isActive = index === activeIndex.value;\n\n              return h(\n                \"div\",\n                {\n                  class: [\"vp-code-tab\", { active: isActive }],\n                  id: `codetab-${props.id}-${index}`,\n                  role: \"tabpanel\",\n                  \"aria-expanded\": isActive,\n                },\n                slots[`tab${index}`]({ value: id, isActive })\n              );\n            }),\n          ])\n        : null;\n  },\n});\n"],"names":["codeTabStore","useStorage","defineComponent","props","slots","activeIndex","ref","tabRefs","shallowRef","updateStore","activateNext","index","activatePrev","keyboardHandler","event","getInitialIndex","valueIndex","id","onMounted","watch","newValue","oldValue","h","isActive","element"],"mappings":"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"}