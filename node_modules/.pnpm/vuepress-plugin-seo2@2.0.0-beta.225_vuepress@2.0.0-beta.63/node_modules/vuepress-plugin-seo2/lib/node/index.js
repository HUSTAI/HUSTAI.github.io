import{colors as $,fs as D}from"@vuepress/utils";import{Logger as W,entries as q,isString as I,isAbsoluteUrl as O,isUrl as P,isLinkHttp as z,removeEndingSlash as y,removeLeadingSlash as V,stripTags as K,getPageText as Q,getAuthor as G,isArray as X,getDateInfo as U,isFunction as Y,startsWith as Z,checkVersion as tt}from"vuepress-shared/node";const A="vuepress-plugin-seo2",s=new W(A),N=({lang:t,path:e,pathLocale:a},{pages:n,siteData:r})=>q(r.locales).map(([o,{lang:i}])=>({path:`${o}${e.replace(a,"")}`,lang:i})).filter(o=>I(o.lang)&&o.lang!==t&&n.some(({path:i})=>i===o.path)),C=({frontmatter:t},{options:{base:e}},{hostname:a})=>{const{banner:n,cover:r}=t;if(n){if(O(n))return f(a,e,n);if(P(n))return n}if(r){if(O(r))return f(a,e,r);if(P(r))return r}return null},H=({content:t},{options:{base:e}},{hostname:a})=>{const n=/!\[.*?\]\((.*?)\)/giu.exec(t);return n?n.map(([,r])=>O(r)?f(a,e,r):P(r)?r:null).filter(r=>r!==null):[]},f=(t,e,a)=>`${z(t)?y(t):`https://${y(t)}`}${e}${V(a)}`,j=(t,e,a="",n="")=>{e in t&&(s.error(`"${$.magenta(e)}" is ${$.red("removed")}${n?`, please use ${$.magenta(n)} instead.`:" and no longer supported"}${a?`
${a}`:""}`),n||delete t[e])},et=t=>{j(t,"seo","","ogp"),j(t,"customMeta","","customHead")},at=(t,e=!0)=>{if(!t.frontmatter.description&&e){if(t.data.excerpt)t.frontmatter.description=K(t.data.excerpt).replace(/(?:\r?\n)+/g," ").replace(/ +/g," ").trim();else{const a=Q(t);t.frontmatter.description=a.length>180?`${a.slice(0,177)}...`:a}t.data.autoDesc=!0}},nt=(t,e,a)=>{var n,r,o,i,l;const{isArticle:c=w=>!!(w.filePathRelative&&!w.frontmatter.home),author:g}=e,{options:{base:x},siteData:d}=a,{frontmatter:{author:m,time:L,date:S=L,tag:u,tags:v=u},data:{git:h={}}}=t,p=((n=d.locales[t.pathLocale])==null?void 0:n.title)||d.title||((r=d.locales["/"])==null?void 0:r.title)||"",F=m===!1?[]:G(m||g),b=h.updatedTime?new Date(h.updatedTime).toISOString():null,J=X(v)?v:I(u)?[u]:[],E=t.title,M=C(t,a,e),R=H(t,a,e),B=N(t,a),T=(i=(o=U(S))==null?void 0:o.value)==null?void 0:i.toISOString(),_=M||R[0]||e.fallBackImage||"";return{"og:url":f(e.hostname,x,t.path),"og:site_name":p,"og:title":E,"og:description":t.frontmatter.description||"","og:type":c(t)?"article":"website","og:image":_,"og:locale":t.lang,"og:locale:alternate":B.map(({lang:w})=>w),...b?{"og:updated_time":b}:{},...e.restrictions?{"og:restrictions:age":e.restrictions}:{},...e.twitterID?{"twitter:creator":e.twitterID}:{},..._?{"twitter:card":"summary_large_image","twitter:image:alt":E}:{},"article:author":(l=F[0])==null?void 0:l.name,"article:tag":J,...T?{"article:published_time":T}:{},...b?{"article:modified_time":b}:{}}},rt=(t,e,a)=>{var n,r;const{isArticle:o=p=>!!(p.filePathRelative&&!p.frontmatter.home),author:i}=e,{title:l,frontmatter:{author:c,description:g,time:x,date:d=x},data:{git:m={}}}=t,L=c===!1?[]:G(c||i),S=(r=(n=U(d))==null?void 0:n.value)==null?void 0:r.toISOString(),u=m.updatedTime?new Date(m.updatedTime).toISOString():null,v=C(t,a,e),h=H(t,a,e);return o(t)?{"@context":"https://schema.org","@type":"Article",headline:l,image:h.length?h:[v||e.fallBackImage||""],datePublished:S,dateModified:u,author:L.map(p=>({"@type":"Person",...p}))}:{"@context":"https://schema.org","@type":"WebPage",name:l,...g?{description:g}:{}}},ot=(t,e)=>Y(e.canonical)?e.canonical(t):I(e.canonical)?`${y(e.canonical)}${t.path}`:null,it=(t,{hostname:e},a)=>N(t,a).map(({lang:n,path:r})=>({lang:n,path:f(e,a.options.base,r)})),k=(t,{name:e,content:a,attribute:n=["article:","og:"].some(r=>Z(e,r))?"property":"name"})=>{a&&t.push(["meta",{[n]:e,content:a}])},lt=(t,e)=>{for(const a in e)switch(a){case"article:tag":e["article:tag"].forEach(n=>k(t,{name:"article:tag",content:n}));break;case"og:locale:alternate":e["og:locale:alternate"].forEach(n=>{n!==e["og:locale"]&&k(t,{name:"og:locale:alternate",content:n})});break;default:e[a]&&k(t,{name:a,content:e[a]})}},st=(t,e)=>{t.push(["script",{type:"application/ld+json"},JSON.stringify(e)])},ct=(t,e)=>{e&&t.push(["link",{rel:"canonical",href:e}])},gt=(t,e)=>{e.forEach(({lang:a,path:n})=>{t.push(["link",{rel:"alternate",hreflang:a.toLowerCase(),href:n}])})},pt=(t,e)=>{t.pages.forEach(a=>{const n=a.frontmatter.head||[],r=ot(a,e),o=it(a,e,t);if(ct(n,r),gt(n,o),a.frontmatter.seo!==!1){const i=nt(a,e,t),l=rt(a,e,t),c=e.ogp?e.ogp(i,a,t):i,g=e.jsonLd?e.jsonLd(l,a,t):l;lt(n,c),st(n,g),e.customHead&&e.customHead(n,a,t)}a.frontmatter.head=n})},dt=async t=>{s.load("Generating robots.txt");const e=t.public("robots.txt");let a=D.existsSync(e)?await D.readFile(e,{encoding:"utf8"}):"";a&&!a.includes("User-agent")?(s.error(),s.update("robots.txt seems invalid!")):(a+=`
User-agent:*
Disallow:
`,await D.writeFile(t.dest("robots.txt"),a,{flag:"w"}),s.succeed())},mt=(t,e=!0)=>a=>{e&&et(t),tt(a,A,"2.0.0-beta.63"),a.env.isDebug&&s.info("Options:",t);const n={name:A};return t.hostname?{...n,extendsPage:r=>{r.frontmatter.seo!==!1&&at(r,t.autoDescription!==!1)},onInitialized:r=>{pt(r,t)},onGenerated:r=>dt(r.dir)}:(s.error(`Option ${$.magenta("hostname")} is required!`),n)};export{mt as seoPlugin};
//# sourceMappingURL=index.js.map
