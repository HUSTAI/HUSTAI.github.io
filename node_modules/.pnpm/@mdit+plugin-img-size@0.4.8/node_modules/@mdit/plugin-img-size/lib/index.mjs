const A=(e,s,h)=>{let o;const a=s,r={ok:!1,pos:s,value:""};for(o=e.charAt(s);s<h&&o.match(/\d/)||o==="%";)o=e.charAt(++s);return r.ok=!0,r.pos=s,r.value=e.slice(a,s),r},g=(e,s,h)=>{const o={ok:!1,pos:0,width:"",height:""};if(s>=h||e.charAt(s)!=="=")return o;s+=1;const a=e.charAt(s);if(a!=="x"&&!a.match(/\d/))return o;const r=A(e,s,h);if(s=r.pos,e.charAt(s)!=="x")return o;s+=1;const i=A(e,s,h);return s=i.pos,o.width=r.value,o.height=i.value,o.pos=s,o.ok=!0,o},k=(e,s)=>{const h=e.env,o=e.pos,a=e.posMax;if(e.src.charAt(e.pos)!=="!"||e.src.charAt(e.pos+1)!=="[")return!1;const r=e.pos+2,i=e.md.helpers.parseLinkLabel(e,e.pos+1,!1);if(i<0)return!1;let t=i+1,n,l="",f="",d="",m="";if(t<a&&e.src.charAt(t)==="("){for(t+=1;t<a&&(n=e.src.charAt(t),!(n!==" "&&n!=="	"));t++);if(t>=a)return!1;let c;c=e.md.helpers.parseLinkDestination(e.src,t,e.posMax),c.ok&&(l=e.md.normalizeLink(c.str),e.md.validateLink(l)?t=c.pos:l="");const p=t;for(;t<a&&(n=e.src.charAt(t),!(n!==" "&&n!=="	"));t++);if(c=e.md.helpers.parseLinkTitle(e.src,t,e.posMax),t<a&&p!==t&&c.ok)for(f=c.str,t=c.pos;t<a&&(n=e.src.charAt(t),!(n!==" "&&n!=="	"));t++);else f="";if(t-1>=0&&(n=e.src.charAt(t-1),n===" "&&(c=g(e.src,t,e.posMax),c.ok)))for(d=c.width,m=c.height,t=c.pos;t<a&&(n=e.src.charAt(t),!(n!==" "&&n!==`
`));t++);if(t>=a||e.src.charAt(t)!==")")return e.pos=o,!1;t+=1}else{let c="";if(typeof h.references>"u")return!1;for(;t<a&&(n=e.src.charAt(t),!(n!==" "&&n!=="	"));t++);if(t<a&&e.src.charAt(t)==="["){const u=t+1;t=e.md.helpers.parseLinkLabel(e,t),t>=0?c=e.src.slice(u,t++):t=i+1}else t=i+1;c||(c=e.src.slice(r,i));const p=h.references[e.md.utils.normalizeReference(c)];if(!p)return e.pos=o,!1;l=p.href,f=p.title||""}if(!s){e.pos=r,e.posMax=i;const c=e.src.slice(r,i),p=[];e.md.inline.parse(c,e.md,e.env,p);const u=e.push("image","img",0);u.attrs=[["src",l],["alt",""]],f&&u.attrs.push(["title",f]),d!==""&&u.attrs.push(["width",d]),m!==""&&u.attrs.push(["height",m]),u.children=p,u.content=c}return e.pos=t,e.posMax=a,!0},x=e=>{e.inline.ruler.before("emphasis","image",k)},v=e=>{const s=e.renderer.rules.image;e.renderer.rules.image=(h,o,a,r,i)=>{var t,n;const l=h[o],f=(n=(t=l.children)==null?void 0:t[0])==null?void 0:n.content;if(f){const d=/^(.*)\|(\d*)(?:x(\d*))?$/.exec(f);if(d){const[,m,c,p]=d;l.content=m,l.children[0].content=m,l.attrSet("width",c),typeof p=="string"&&l.attrSet("height",p)}}return s(h,o,a,r,i)}};export{x as imgSize,v as obsidianImageSize};
//# sourceMappingURL=index.mjs.map
