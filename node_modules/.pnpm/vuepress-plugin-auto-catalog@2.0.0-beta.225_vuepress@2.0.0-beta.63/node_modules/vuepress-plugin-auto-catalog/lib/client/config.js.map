{"version":3,"file":"config.js","sources":["../../src/client/components/AutoCatalog.ts","../../src/client/config.ts"],"sourcesContent":["import { usePageData, useSiteData } from \"@vuepress/client\";\nimport type { VNode } from \"vue\";\nimport { computed, defineComponent, h } from \"vue\";\nimport type { RouteMeta } from \"vue-router\";\nimport { useRouter } from \"vue-router\";\nimport {\n  VPLink,\n  endsWith,\n  keys,\n  startsWith,\n  useLocaleConfig,\n} from \"vuepress-shared/client\";\n\nimport type { AutoCatalogLocaleConfig } from \"../../shared/index.js\";\nimport { useAutoCatalogIconComponent } from \"../helpers/index.js\";\n\nimport \"../styles/auto-catalog.scss\";\n\ndeclare const AUTO_CATALOG_LOCALES: AutoCatalogLocaleConfig;\ndeclare const AUTO_CATALOG_TITLE_META_KEY: string;\ndeclare const AUTO_CATALOG_ICON_META_KEY: string;\ndeclare const AUTO_CATALOG_ORDER_META_KEY: string;\ndeclare const AUTO_CATALOG_INDEX_META_KEY: string;\n\nexport interface AutoCatalogProps {\n  base?: string;\n  level?: 1 | 2 | 3;\n}\n\ninterface CatalogInfo {\n  title: string;\n  icon: string | null | undefined;\n  base: string;\n  order: number | null | undefined;\n  level: number;\n  path: string;\n  children?: CatalogInfo[];\n}\n\nexport default defineComponent({\n  name: \"AutoCatalog\",\n\n  props: {\n    /**\n     * Catalog Base\n     *\n     * 目录的基础路径\n     *\n     * @default current route base\n     */\n    base: {\n      type: String,\n      default: \"\",\n    },\n\n    /**\n     * Max level of catalog\n     *\n     * @description only 1,2,3 are supported\n     *\n     * Catalog 的最大层级\n     *\n     * @description 目前仅支持 1,2,3\n     *\n     * @default 3\n     */\n    level: {\n      type: Number,\n      default: 3,\n    },\n\n    /**\n     * Whether show index for catalog\n     *\n     * 目录是否显示索引\n     */\n    index: Boolean,\n  },\n\n  setup(props) {\n    const iconComponent = useAutoCatalogIconComponent();\n    const locale = useLocaleConfig(AUTO_CATALOG_LOCALES);\n    const page = usePageData();\n    const router = useRouter();\n    const siteData = useSiteData();\n\n    const shouldIndex = (meta: RouteMeta): boolean => {\n      const index = <boolean | undefined>meta[AUTO_CATALOG_INDEX_META_KEY];\n\n      return typeof index === \"undefined\" || index;\n    };\n\n    const getCatalogInfo = (): CatalogInfo[] => {\n      const base = props.base || page.value.path.replace(/\\/[^/]+$/, \"/\");\n      const routes = router.getRoutes();\n      const result: CatalogInfo[] = [];\n\n      routes\n        .filter(({ meta, path }) => {\n          // filter those under current base\n          if (!startsWith(path, base) || path === base) return false;\n\n          if (base === \"/\") {\n            const otherLocales = keys(siteData.value.locales).filter(\n              (item) => item !== \"/\"\n            );\n\n            // exclude 404 page and other locales\n            if (\n              path === \"/404.html\" ||\n              otherLocales.some((localePath) => startsWith(path, localePath))\n            )\n              return false;\n          }\n\n          return (\n            // filter real page\n            ((endsWith(path, \".html\") && !endsWith(path, \"/index.html\")) ||\n              endsWith(path, \"/\")) &&\n            // page should be indexed\n            shouldIndex(meta)\n          );\n        })\n        .map(({ path, meta }) => {\n          const level = path.substring(base.length).split(\"/\").length;\n\n          return {\n            title: <string>meta[AUTO_CATALOG_TITLE_META_KEY] || \"\",\n            icon: <string | null | undefined>meta[AUTO_CATALOG_ICON_META_KEY],\n            base: path.replace(/\\/[^/]+\\/?$/, \"/\"),\n            order:\n              <number | null | undefined>meta[AUTO_CATALOG_ORDER_META_KEY] ||\n              null,\n            level: endsWith(path, \"/\") ? level - 1 : level,\n            path,\n          };\n        })\n        .filter(({ title, level }) => title && level <= props.level)\n        .sort(\n          (\n            { title: titleA, level: levelA, path: pathA, order: orderA },\n            { title: titleB, level: levelB, path: pathB, order: orderB }\n          ) => {\n            const level = levelA - levelB;\n\n            if (level) return level;\n\n            // check README.md, it should be first one\n            if (endsWith(pathA, \"/index.html\")) return -1;\n            if (endsWith(pathB, \"/index.html\")) return 1;\n\n            // infoA order is absent\n            if (orderA === null) {\n              // infoB order is absent\n              if (orderB === null)\n                // compare title\n                return titleA.localeCompare(titleB);\n\n              // infoB order is present\n              return orderB;\n            }\n\n            // infoB order is absent\n            if (orderB === null) return orderA;\n\n            // now we are sure both order exist\n\n            // infoA order is positive\n            if (orderA > 0) {\n              if (orderB > 0) return orderA - orderB;\n\n              return -1;\n            }\n\n            // both order are negative\n            if (orderB < 0) return orderA - orderB;\n\n            return 1;\n          }\n        )\n        .forEach((info) => {\n          const { base, level } = info;\n\n          switch (level) {\n            case 1:\n              result.push(info);\n              break;\n\n            case 2: {\n              const parent = result.find((item) => item.path === base);\n\n              if (parent) (parent.children ??= []).push(info);\n              break;\n            }\n\n            default: {\n              const grandParent = result.find(\n                (item) => item.path === base.replace(/\\/[^/]+\\/$/, \"/\")\n              );\n\n              if (grandParent) {\n                const parent = grandParent.children?.find(\n                  (item) => item.path === base\n                );\n\n                if (parent) (parent.children ??= []).push(info);\n              }\n            }\n          }\n        });\n\n      return result;\n    };\n\n    const info = computed(() => getCatalogInfo());\n\n    return (): VNode =>\n      h(\"div\", { class: \"vp-catalog\" }, [\n        h(\"h2\", { class: \"vp-catalog-main-title\" }, locale.value.title),\n\n        info.value.length\n          ? info.value.map(\n              ({ children = [], icon, path, title }, mainIndex) => [\n                h(\n                  \"h3\",\n                  {\n                    id: title,\n                    class: [\n                      \"vp-catalog-child-title\",\n                      { \"has-children\": children.length },\n                    ],\n                  },\n                  [\n                    h(\n                      \"a\",\n                      {\n                        href: `#${title}`,\n                        class: \"header-anchor\",\n                        \"aria-hidden\": true,\n                      },\n                      \"#\"\n                    ),\n                    h(VPLink, { class: \"vp-catalog-title\", to: path }, () => [\n                      props.index ? `${mainIndex + 1}.` : null,\n                      icon && iconComponent ? h(iconComponent, { icon }) : null,\n                      title || path,\n                    ]),\n                  ]\n                ),\n                children.length\n                  ? h(\n                      \"ul\",\n                      { class: \"vp-catalog-child-catalogs\" },\n                      children.map(\n                        ({ children = [], icon, path, title }, index) =>\n                          h(\"li\", { class: \"vp-child-catalog\" }, [\n                            h(\n                              \"div\",\n                              {\n                                class: [\n                                  \"vp-catalog-sub-title\",\n                                  { \"has-children\": children.length },\n                                ],\n                              },\n                              [\n                                h(\n                                  \"a\",\n                                  { href: `#${title}`, class: \"header-anchor\" },\n                                  \"#\"\n                                ),\n                                h(\n                                  VPLink,\n                                  { class: \"vp-catalog-title\", to: path },\n                                  () => [\n                                    props.index\n                                      ? `${mainIndex + 1}.${index + 1}`\n                                      : null,\n                                    icon && iconComponent\n                                      ? h(iconComponent, { icon })\n                                      : null,\n                                    title || path,\n                                  ]\n                                ),\n                              ]\n                            ),\n                            children.length\n                              ? h(\n                                  \"div\",\n                                  { class: \"v-sub-catalogs\" },\n                                  children.map(\n                                    ({ icon, path, title }, subIndex) =>\n                                      h(\n                                        VPLink,\n                                        {\n                                          class: \"vp-sub-catalog\",\n                                          to: path,\n                                        },\n                                        () => [\n                                          props.index\n                                            ? `${mainIndex + 1}.${index + 1}.${\n                                                subIndex + 1\n                                              }`\n                                            : null,\n                                          icon && iconComponent\n                                            ? h(iconComponent, { icon })\n                                            : null,\n                                          title || path,\n                                        ]\n                                      )\n                                  )\n                                )\n                              : null,\n                          ])\n                      )\n                    )\n                  : null,\n              ]\n            )\n          : h(\"p\", { class: \"vp-empty-catalog\" }, locale.value.empty),\n      ]);\n  },\n});\n","import { defineClientConfig } from \"@vuepress/client\";\nimport { hasGlobalComponent } from \"vuepress-shared/client\";\n\nimport AutoCatalog from \"./components/AutoCatalog.js\";\nimport { injectAutoCatalogIconComponent } from \"./helpers/index.js\";\n\nexport default defineClientConfig({\n  enhance: ({ app }) => {\n    injectAutoCatalogIconComponent(app);\n    if (!hasGlobalComponent(\"AutoCatalog\", app))\n      app.component(\"AutoCatalog\", AutoCatalog);\n  },\n});\n"],"names":["e","defineComponent","props","iconComponent","useAutoCatalogIconComponent","locale","useLocaleConfig","page","usePageData","router","useRouter","siteData","useSiteData","shouldIndex","meta","index","getCatalogInfo","base","routes","result","path","startsWith","otherLocales","keys","item","localePath","endsWith","level","title","titleA","levelA","pathA","orderA","titleB","levelB","pathB","orderB","info","_a","parent","grandParent","computed","h","children","icon","mainIndex","VPLink","subIndex","config","defineClientConfig","app","injectAutoCatalogIconComponent","hasGlobalComponent","AutoCatalog"],"mappings":"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"}