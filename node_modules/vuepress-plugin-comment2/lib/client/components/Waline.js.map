{"version":3,"file":"Waline.js","sources":["../../../src/client/components/Waline.ts"],"sourcesContent":["import { usePageFrontmatter, usePageLang } from \"@vuepress/client\";\nimport { pageviewCount } from \"@waline/client/dist/pageview.mjs\";\nimport type { VNode } from \"vue\";\nimport {\n  computed,\n  defineAsyncComponent,\n  defineComponent,\n  h,\n  nextTick,\n  onMounted,\n  watch,\n} from \"vue\";\nimport { LoadingIcon, useLocaleConfig } from \"vuepress-shared/client\";\n\nimport type {\n  CommentPluginFrontmatter,\n  WalineLocaleConfig,\n} from \"../../shared/index.js\";\nimport { useWalineOptions } from \"../helpers/index.js\";\n\nimport \"@waline/client/dist/waline.css\";\nimport \"../styles/waline.scss\";\n\ndeclare const WALINE_META: boolean;\ndeclare const WALINE_LOCALES: WalineLocaleConfig;\n\nconst walineLocales = WALINE_LOCALES;\n\nif (WALINE_META)\n  import(\n    /* webpackChunkName: \"waline\" */ \"@waline/client/dist/waline-meta.css\"\n  );\n\nexport { pageviewCount };\n\nexport default defineComponent({\n  name: \"WalineComment\",\n\n  props: {\n    /**\n     * The path of the comment\n     */\n    identifier: {\n      type: String,\n      required: true,\n    },\n  },\n\n  setup(props) {\n    const walineOptions = useWalineOptions();\n    const frontmatter = usePageFrontmatter<CommentPluginFrontmatter>();\n    const lang = usePageLang();\n    const walineLocale = useLocaleConfig(walineLocales);\n\n    let abort: () => void;\n    const enableWaline = Boolean(walineOptions.serverURL);\n\n    const enablePageViews = computed(() => {\n      if (!enableWaline) return false;\n      const pluginConfig = walineOptions.pageview !== false;\n      const pageConfig = frontmatter.value.pageview;\n\n      return (\n        // Enable in page\n        Boolean(pageConfig) ||\n        // not disabled in anywhere\n        (pluginConfig !== false && pageConfig !== false)\n      );\n    });\n\n    const walineProps = computed(() => ({\n      lang: lang.value === \"zh-CN\" ? \"zh-CN\" : \"en\",\n      locale: walineLocale.value,\n      dark: \"html.dark\",\n      ...walineOptions,\n      path: props.identifier,\n    }));\n\n    onMounted(() => {\n      watch(\n        () => props.identifier,\n        () => {\n          abort?.();\n\n          if (enablePageViews.value)\n            void nextTick().then(() => {\n              setTimeout(() => {\n                abort = pageviewCount({\n                  serverURL: walineOptions.serverURL,\n                  path: props.identifier,\n                });\n              }, walineOptions.delay || 800);\n            });\n        },\n        { immediate: true }\n      );\n    });\n\n    return (): VNode | null =>\n      enableWaline\n        ? h(\n            \"div\",\n            { id: \"comment\", class: \"waline-wrapper\" },\n            h(\n              defineAsyncComponent({\n                loader: async () =>\n                  (\n                    await import(\n                      /* webpackChunkName: \"waline\" */ \"@waline/client/dist/component.mjs\"\n                    )\n                  ).Waline,\n                loadingComponent: LoadingIcon,\n              }),\n              walineProps.value\n            )\n          )\n        : null;\n  },\n});\n"],"names":["walineLocales","Waline","defineComponent","props","walineOptions","useWalineOptions","frontmatter","usePageFrontmatter","lang","usePageLang","walineLocale","useLocaleConfig","abort","enableWaline","enablePageViews","computed","pluginConfig","pageConfig","walineProps","onMounted","watch","nextTick","pageviewCount","h","defineAsyncComponent","LoadingIcon"],"mappings":"8fA0BA,MAAMA,EAAgB,eAElB,aACF,OACmC,qCACnC,EAIF,IAAAC,EAAeC,EAAgB,CAC7B,KAAM,gBAEN,MAAO,CAIL,WAAY,CACV,KAAM,OACN,SAAU,EACZ,CACF,EAEA,MAAMC,EAAO,CACX,MAAMC,EAAgBC,EAAiB,EACjCC,EAAcC,IACdC,EAAOC,EACPC,EAAAA,EAAeC,EAAgBX,CAAa,EAElD,IAAIY,EACJ,MAAMC,EAAe,CAAQT,CAAAA,EAAc,UAErCU,EAAkBC,EAAS,IAAM,CACrC,GAAI,CAACF,EAAc,MAAO,GAC1B,MAAMG,EAAeZ,EAAc,WAAa,GAC1Ca,EAAaX,EAAY,MAAM,SAErC,MAEE,CAAA,CAAQW,GAEPD,IAAiB,IAASC,IAAe,EAE9C,CAAC,EAEKC,EAAcH,EAAS,KAAO,CAClC,KAAMP,EAAK,QAAU,QAAU,QAAU,KACzC,OAAQE,EAAa,MACrB,KAAM,YACN,GAAGN,EACH,KAAMD,EAAM,UACd,EAAE,EAEF,OAAAgB,EAAU,IAAM,CACdC,EACE,IAAMjB,EAAM,WACZ,IAAM,CACJS,GAAA,MAAAA,IAEIE,EAAgB,OACbO,EAAS,EAAE,KAAK,IAAM,CACzB,WAAW,IAAM,CACfT,EAAQU,EAAc,CACpB,UAAWlB,EAAc,UACzB,KAAMD,EAAM,UACd,CAAC,CACH,EAAGC,EAAc,OAAS,GAAG,CAC/B,CAAC,CACL,EACA,CAAE,UAAW,EAAK,CACpB,CACF,CAAC,EAEM,IACLS,EACIU,EACE,MACA,CAAE,GAAI,UAAW,MAAO,gBAAiB,EACzCA,EACEC,EAAqB,CACnB,OAAQ,UAEJ,KACmC,QAAA,mCACnC,GACA,OACJ,iBAAkBC,CACpB,CAAC,EACDP,EAAY,KACd,CACF,EACA,IACR,CACF,CAAC"}