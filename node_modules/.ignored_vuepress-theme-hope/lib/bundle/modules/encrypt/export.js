import{h as r,defineComponent as m,ref as p,computed as d,nextTick as O,onMounted as h}from"vue";import{n as T}from"../../FadeSlideY-2ffb0206.js";import{usePageFrontmatter as V,usePageData as _}from"@vuepress/client";import{IconBase as H,keys as I,startsWith as M}from"vuepress-shared/client";import{a as w,b as x}from"../../themeData-ed37366d.js";import{useStorage as E,useSessionStorage as b}from"@vueuse/core";import{compareSync as y}from"bcrypt-ts/browser";import{isPlainObject as G}from"@vuepress/shared";import"@vuepress/plugin-theme-data/client";const g=()=>r(H,{name:"lock"},()=>r("path",{d:"M787.168 952.268H236.832c-30.395 0-55.033-24.638-55.033-55.033V429.45c0-30.395 24.638-55.034 55.033-55.034h82.55V264.35c0-106.38 86.238-192.618 192.618-192.618S704.618 157.97 704.618 264.35v110.066h82.55c30.395 0 55.033 24.639 55.033 55.034v467.785c0 30.395-24.639 55.033-55.033 55.033zM484.483 672.046v115.122h55.034V672.046c31.99-11.373 55.033-41.605 55.033-77.496 0-45.592-36.958-82.55-82.55-82.55s-82.55 36.958-82.55 82.55c0 35.89 23.042 66.123 55.033 77.496zM622.067 264.35c0-60.788-49.28-110.067-110.067-110.067s-110.067 49.28-110.067 110.067v110.066h220.135V264.35z"}));g.displayName="LockIcon";var k=m({name:"PasswordModal",props:{full:Boolean},emits:["verify"],setup(l,{emit:t}){const o=V(),s=w(),n=p(""),e=p(!1),a=p(!1),u=d(()=>s.value.encryptLocales);let v=null;const c=()=>{v&&clearTimeout(v),e.value=!1,t("verify",n.value,a.value),O().then(()=>{e.value=!0,v=setTimeout(()=>{e.value=!1},1e3)})};return()=>r("div",{class:["vp-decrypt-layer",{expand:l.full||o.value.home}]},r("div",{class:"vp-decrypt-modal"},[r("div",{class:["vp-decrypt-hint",{tried:e.value}]},e.value?u.value.errorHint:r(g,{"aria-label":u.value.iconLabel})),r("div",{class:"vp-decrypt-input"},[r("input",{type:"password",value:n.value,placeholder:u.value.placeholder,onInput:({target:i})=>{n.value=i.value},onKeydown:({key:i})=>{i==="Enter"&&c()}})]),r("div",{class:"vp-remember-password"},[r("input",{type:"checkbox",value:a.value,onChange:()=>a.value=!a.value}),u.value.remember]),r("button",{type:"button",class:"vp-decrypt-submit",onClick:()=>c()},"OK")]))}});const P=()=>{const l=x();return d(()=>l.value.encrypt||{})},S="VUEPRESS_HOPE_GLOBAL_TOKEN",K=()=>{const l=P(),t=E(S,""),o=b(S,""),s=d(()=>{const{global:e=!1,admin:a=[]}=l.value;return e&&a.length>0}),n=d(()=>{if(s.value){if(t.value)return l.value.admin.some(e=>y(t.value,e));if(o.value)return l.value.admin.some(e=>y(o.value,e))}return!1});return{isEncrypted:s,isDecrypted:n,validate:(e,a=!1)=>{(a?t:o).value=e}}},f=(l="",t)=>!!l&&y(l,t),D="VUEPRESS_HOPE_PATH_TOKEN",j=()=>{const l=_(),t=P(),o=E(D,{}),s=b(D,{}),n=a=>G(t.value.config)?I(t.value.config).filter(u=>M(decodeURI(a),u)).sort((u,v)=>v.length-u.length):[],e=a=>{const u=n(a);if(u.length>0){const{config:v={}}=t.value;return{isEncrypted:!0,isDecrypted:u.some(c=>o.value[c]&&v[c].some(i=>f(o.value[c],i))||s.value[c]&&v[c].some(i=>f(s.value[c],i)))}}return{isDecrypted:!1,isEncrypted:!1}};return{status:d(()=>e(l.value.path)),getStatus:e,validate:(a,u=!1)=>{const{config:v={}}=t.value,c=n(l.value.path);for(const i of c)if(v[i].filter(L=>f(a,L))){(u?o:s).value[i]=a;break}}}};var z=m({name:"GlobalEncrypt",slots:Object,setup(l,{slots:t}){const{isDecrypted:o,isEncrypted:s,validate:n}=K(),e=p(!1);return h(()=>{e.value=!0}),()=>r(T,()=>s.value?e.value?o.value?t.default():r(k,{full:!0,onVerify:n}):null:t.default())}}),B=m({name:"LocalEncrypt",slots:Object,setup(l,{slots:t}){const{status:o,validate:s}=j(),n=p(!1);return h(()=>{n.value=!0}),()=>{const{isEncrypted:e,isDecrypted:a}=o.value;return e?n.value?a?t.default()||null:r(k,{full:!0,onVerify:s}):null:t.default()||null}}});export{z as GlobalEncrypt,B as LocalEncrypt};
//# sourceMappingURL=export.js.map
