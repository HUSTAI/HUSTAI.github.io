import { b as b$1, f } from './chunk-Q6MEJHLE.js';
import './chunk-XLPAIKLR.js';

var g=/^Format:[\s\t]*/,R=/^Style:[\s\t]*/,_=/^Dialogue:[\s\t]*/,b=/[\s\t]*,[\s\t]*/,w=/\{[^}]+\}/g,I=/\\N/g,v=/^\[(.*)[\s\t]?Styles\]$/,S=/^\[(.*)[\s\t]?Events\]$/,F=class{constructor(){this.m=0,this.a=null,this.d=[],this.p=[],this.j=null,this.J={};}async init(t){this.f=t,t.errors&&(this.e=(await import('./errors-UH4WX4S7-RS4JRTIB.js')).ParseErrorBuilder);}parse(t,a){if(this.m)switch(this.m){case 1:if(t==="")this.m=0;else if(R.test(t))if(this.j){let e=t.replace(R,"").split(b);this.T(e);}else this.h(this.e?.G("Style",a));else g.test(t)?this.j=t.replace(g,"").split(b):S.test(t)&&(this.j=null,this.m=2);break;case 2:if(t==="")this.K();else if(_.test(t))if(this.K(),this.j){let e=t.replace(_,"").split(b),s=this.U(e,a);s&&(this.a=s);}else this.h(this.e?.G("Dialogue",a));else this.a?this.a.text+=`
`+t.replace(w,"").replace(I,`
`):g.test(t)?this.j=t.replace(g,"").split(b):v.test(t)?(this.j=null,this.m=1):S.test(t)&&(this.j=null);}else t===""||(v.test(t)?(this.j=null,this.m=1):S.test(t)&&(this.j=null,this.m=2));}done(){return {metadata:{},cues:this.d,regions:[],errors:this.p}}K(){this.a&&(this.d.push(this.a),this.f.onCue?.(this.a),this.a=null);}T(t){let a="Default",e={},s,r="center",l="bottom",o,h=1.2,c,u,n=3,p=[];for(let f=0;f<this.j.length;f++){let x=this.j[f],i=t[f];switch(x){case"Name":a=i;break;case"Fontname":e["font-family"]=i;break;case"Fontsize":e["font-size"]=`calc(${i} / var(--overlay-height))`;break;case"PrimaryColour":let E=k(i);E&&(e["--cue-color"]=E);break;case"BorderStyle":n=parseInt(i,10);break;case"BackColour":u=k(i);break;case"OutlineColour":let j=k(i);j&&(c=j);break;case"Bold":parseInt(i)&&(e["font-weight"]="bold");break;case"Italic":parseInt(i)&&(e["font-style"]="italic");break;case"Underline":parseInt(i)&&(e["text-decoration"]="underline");break;case"StrikeOut":parseInt(i)&&(e["text-decoration"]="line-through");break;case"Spacing":e["letter-spacing"]=i+"px";break;case"AlphaLevel":e.opacity=parseFloat(i);break;case"ScaleX":p.push(`scaleX(${parseFloat(i)/100})`);break;case"ScaleY":p.push(`scaleY(${parseFloat(i)/100})`);break;case"Angle":p.push(`rotate(${i}deg)`);break;case"Shadow":h=parseInt(i,10)*1.2;break;case"MarginL":e["--cue-width"]="auto",e["--cue-left"]=parseFloat(i)+"px";break;case"MarginR":e["--cue-width"]="auto",e["--cue-right"]=parseFloat(i)+"px";break;case"MarginV":o=parseFloat(i);break;case"Outline":s=parseInt(i,10);break;case"Alignment":let d=parseInt(i,10);switch(d>=4&&(l=d>=7?"top":"center"),d%3){case 1:r="start";break;case 2:r="center";break;case 3:r="end";break}}}if(e.L=l,e["--cue-white-space"]="normal",e["--cue-line-height"]="normal",e["--cue-text-align"]=r,l==="center"?(e["--cue-top"]="50%",p.push("translateY(-50%)")):e[`--cue-${l}`]=(o||0)+"px",n===1&&(e["--cue-padding-y"]="0"),(n===1||u)&&(e["--cue-bg-color"]=n===1?"none":u),n===3&&c&&(e["--cue-outline"]=`${s}px solid ${c}`),n===1&&typeof s=="number"){let f=u??"#000";e["--cue-text-shadow"]=[c&&T(s*1.2,h*1.2,c),c?T(s*(s/2),h*(s/2),f):T(s,h,f)].filter(Boolean).join(", ");}p.length&&(e["--cue-transform"]=p.join(" ")),this.J[a]=e;}U(t,a){let e=this.V(t),s=this.o(e.Start,e.End,a);if(!s)return;let r=new b$1(s[0],s[1],""),l={...this.J[e.Style]||{}},o=e.Name?`<v ${e.Name}>`:"",h=l.L,c=e.MarginL&&parseFloat(e.MarginL),u=e.MarginR&&parseFloat(e.MarginR),n=e.MarginV&&parseFloat(e.MarginV);return c&&(l["--cue-width"]="auto",l["--cue-left"]=c+"px"),u&&(l["--cue-width"]="auto",l["--cue-right"]=u+"px"),n&&h!=="center"&&(l[`--cue-${h}`]=n+"px"),r.text=o+t.slice(this.j.length-1).join(", ").replace(w,"").replace(I,`
`),delete l.L,Object.keys(l).length&&(r.style=l),r}V(t){let a={};for(let e=0;e<this.j.length;e++)a[this.j[e]]=t[e];return a}o(t,a,e){let s=f(t),r=f(a);if(s!==null&&r!==null&&r>s)return [s,r];s===null&&this.h(this.e?.D(t,e)),r===null&&this.h(this.e?.E(a,e)),s!=null&&r!==null&&r>s&&this.h(this.e?.F(s,r,e));}h(t){if(t){if(this.p.push(t),this.f.strict)throw this.f.cancel(),t;this.f.onError?.(t);}}};function k(t){let a=parseInt(t.replace("&H",""),16);if(a>=0){let s=(a>>24&255^255)/255,r=a>>16&255,l=a>>8&255;return "rgba("+[a&255,l,r,s].join(",")+")"}return null}function T(t,a,e){let s=Math.ceil(2*Math.PI*t),r="";for(let l=0;l<s;l++){let o=2*Math.PI*l/s;r+=t*Math.cos(o)+"px "+a*Math.sin(o)+"px 0 "+e+(l==s-1?"":",");}return r}function L(){return new F}

export { F as SSAParser, L as default };
