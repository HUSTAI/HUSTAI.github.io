{"version":3,"file":"FlowChart.js","sources":["../../../src/client/components/FlowChart.ts"],"sourcesContent":["import { useDebounceFn, useEventListener } from \"@vueuse/core\";\nimport type { Chart } from \"flowchart.ts\";\nimport type { PropType, VNode } from \"vue\";\nimport { computed, defineComponent, h, onMounted, ref, shallowRef } from \"vue\";\nimport { LoadingIcon, atou } from \"vuepress-shared/client\";\n\nimport { flowchartPresets } from \"../utils/index.js\";\n\nimport \"../styles/flowchart.scss\";\n\ndeclare const MARKDOWN_ENHANCE_DELAY: number;\n\nexport default defineComponent({\n  name: \"FlowChart\",\n\n  props: {\n    /**\n     * Flowchart code content\n     *\n     * 流程图代码内容\n     */\n    code: { type: String, required: true },\n\n    /**\n     * Flowchart id\n     *\n     * 流程图 id\n     */\n    id: { type: String, required: true },\n\n    /**\n     * Flowchart preset\n     *\n     * 流程图预设\n     */\n    preset: {\n      type: String as PropType<\"ant\" | \"pie\" | \"vue\">,\n      default: \"vue\",\n    },\n  },\n\n  setup(props) {\n    let flowchart: Chart | null = null;\n    const element = shallowRef<HTMLDivElement>();\n\n    const loading = ref(true);\n    const scale = ref(1);\n\n    const preset = computed<Record<string, unknown>>(() => {\n      const preset = flowchartPresets[props.preset];\n\n      if (!preset) {\n        console.warn(`[md-enhance:flowchart] Unknown preset: ${props.preset}`);\n\n        return flowchartPresets.vue;\n      }\n\n      return preset;\n    });\n\n    const getScale = (width: number): number =>\n      width < 419 ? 0.8 : width > 1280 ? 1 : 0.9;\n\n    onMounted(() => {\n      void Promise.all([\n        import(/* webpackChunkName: \"flowchart\" */ \"flowchart.ts\"),\n        // delay\n        new Promise((resolve) => setTimeout(resolve, MARKDOWN_ENHANCE_DELAY)),\n      ]).then(([{ parse }]) => {\n        flowchart = parse(atou(props.code));\n\n        // update scale\n        scale.value = getScale(window.innerWidth);\n\n        loading.value = false;\n\n        // draw svg to #id\n        flowchart.draw(props.id, { ...preset.value, scale: scale.value });\n      });\n\n      useEventListener(\n        \"resize\",\n        useDebounceFn(() => {\n          if (flowchart) {\n            const newScale = getScale(window.innerWidth);\n\n            if (scale.value !== newScale) {\n              scale.value = newScale;\n\n              flowchart.draw(props.id, { ...preset.value, scale: newScale });\n            }\n          }\n        }, 100)\n      );\n    });\n\n    return (): (VNode | null)[] => [\n      loading.value\n        ? h(LoadingIcon, { class: \"flowchart-loading\", height: 192 })\n        : null,\n      h(\"div\", {\n        ref: element,\n        class: [\"flowchart-wrapper\", props.preset],\n        id: props.id,\n        style: {\n          display: loading.value ? \"none\" : \"block\",\n        },\n      }),\n    ];\n  },\n});\n"],"names":["FlowChart","defineComponent","props","flowchart","element","shallowRef","loading","ref","scale","preset","computed","flowchartPresets","getScale","width","onMounted","resolve","parse","atou","useEventListener","useDebounceFn","newScale","h","LoadingIcon"],"mappings":"+SAYA,IAAAA,EAAeC,EAAgB,CAC7B,KAAM,YAEN,MAAO,CAML,KAAM,CAAE,KAAM,OAAQ,SAAU,EAAK,EAOrC,GAAI,CAAE,KAAM,OAAQ,SAAU,EAAK,EAOnC,OAAQ,CACN,KAAM,OACN,QAAS,KACX,CACF,EAEA,MAAMC,EAAO,CACX,IAAIC,EAA0B,KAC9B,MAAMC,EAAUC,IAEVC,EAAUC,EAAI,EAAI,EAClBC,EAAQD,EAAI,CAAC,EAEbE,EAASC,EAAkC,IAChCC,EAAiBT,EAAM,MAAM,IAG1C,QAAQ,KAAK,0CAA0CA,EAAM,QAAQ,EAE9DS,EAAiB,IAI3B,EAEKC,EAAYC,GAChBA,EAAQ,IAAM,GAAMA,EAAQ,KAAO,EAAI,GAEzC,OAAAC,EAAU,IAAM,CACT,QAAQ,IAAI,CACf,OAA2C,cAAc,EAEzD,IAAI,QAASC,GAAY,WAAWA,EAAS,sBAAsB,CAAC,CACtE,CAAC,EAAE,KAAK,CAAC,CAAC,CAAE,MAAAC,CAAM,CAAC,IAAM,CACvBb,EAAYa,EAAMC,EAAKf,EAAM,IAAI,CAAC,EAGlCM,EAAM,MAAQI,EAAS,OAAO,UAAU,EAExCN,EAAQ,MAAQ,GAGhBH,EAAU,KAAKD,EAAM,GAAI,CAAE,GAAGO,EAAO,MAAO,MAAOD,EAAM,KAAM,CAAC,CAClE,CAAC,EAEDU,EACE,SACAC,EAAc,IAAM,CAClB,GAAIhB,EAAW,CACb,MAAMiB,EAAWR,EAAS,OAAO,UAAU,EAEvCJ,EAAM,QAAUY,IAClBZ,EAAM,MAAQY,EAEdjB,EAAU,KAAKD,EAAM,GAAI,CAAE,GAAGO,EAAO,MAAO,MAAOW,CAAS,CAAC,GAGnE,EAAG,GAAG,CACR,CACF,CAAC,EAEM,IAAwB,CAC7Bd,EAAQ,MACJe,EAAEC,EAAa,CAAE,MAAO,oBAAqB,OAAQ,GAAI,CAAC,EAC1D,KACJD,EAAE,MAAO,CACP,IAAKjB,EACL,MAAO,CAAC,oBAAqBF,EAAM,MAAM,EACzC,GAAIA,EAAM,GACV,MAAO,CACL,QAASI,EAAQ,MAAQ,OAAS,OACpC,CACF,CAAC,CACH,CACF,CACF,CAAC"}