{"version":3,"file":"config.js","sources":["../../src/client/composables/setup.ts","../../src/client/config.ts"],"sourcesContent":["import { usePageData, usePageFrontmatter } from \"@vuepress/client\";\nimport { isLinkHttp, isPlainObject, removeEndingSlash } from \"@vuepress/shared\";\nimport { useEventListener } from \"@vueuse/core\";\nimport { computed, onMounted, watchEffect } from \"vue\";\nimport type { RequiredLocaleConfig } from \"vuepress-shared/client\";\nimport { useLocaleConfig } from \"vuepress-shared/client\";\n\nimport type {\n  CopyrightLocaleData,\n  CopyrightPluginFrontmatter,\n  CopyrightPluginPageData,\n} from \"../../shared/index.js\";\n\ndeclare const COPYRIGHT_CANONICAL: string;\ndeclare const COPYRIGHT_DISABLE_COPY: boolean;\ndeclare const COPYRIGHT_DISABLE_SELECTION: boolean;\ndeclare const COPYRIGHT_GLOBAL: boolean;\ndeclare const COPYRIGHT_LOCALES: RequiredLocaleConfig<CopyrightLocaleData>;\ndeclare const COPYRIGHT_TRIGGER_WORDS: number;\n\nconst canonical = COPYRIGHT_CANONICAL;\n\nexport const setupCopyright = (): void => {\n  const frontmatter = usePageFrontmatter<CopyrightPluginFrontmatter>();\n  const locale = useLocaleConfig(COPYRIGHT_LOCALES);\n  const page = usePageData<CopyrightPluginPageData>();\n\n  const enabled = computed(\n    () =>\n      Boolean(frontmatter.value.copy) ||\n      (frontmatter.value.copy !== false && COPYRIGHT_GLOBAL)\n  );\n\n  const disableCopy = computed(() => {\n    const frontmatterOptions = frontmatter.value.copy;\n\n    if (!enabled.value) return false;\n\n    if (\n      isPlainObject(frontmatterOptions) &&\n      \"disableCopy\" in frontmatterOptions\n    )\n      return frontmatterOptions.disableCopy;\n\n    return COPYRIGHT_DISABLE_COPY;\n  });\n\n  const disableSelection = computed(() => {\n    const frontmatterOptions = frontmatter.value.copy;\n\n    if (!enabled.value) return false;\n\n    if (\n      isPlainObject(frontmatterOptions) &&\n      \"disableSelection\" in frontmatterOptions\n    )\n      return frontmatterOptions.disableSelection;\n\n    return COPYRIGHT_DISABLE_SELECTION;\n  });\n\n  const getCopyright = (): string => {\n    const { author: authorInfo = \"\", license: licenseInfo = \"\" } =\n      page.value.copyright;\n    const { author, license, link } = locale.value;\n\n    return [\n      authorInfo ? author.replace(\":author\", authorInfo) : \"\",\n      licenseInfo ? license.replace(\":license\", licenseInfo) : \"\",\n      link.replace(\n        \":link\",\n        canonical\n          ? `${removeEndingSlash(\n              isLinkHttp(canonical) ? canonical : `https://${canonical}`\n            )}${page.value.path}`\n          : window.location.href\n      ),\n    ]\n      .filter((item) => item)\n      .join(\"\\n\");\n  };\n\n  const onCopy = (event: ClipboardEvent): void => {\n    const selection = getSelection();\n\n    if (selection) {\n      const textRange = selection.getRangeAt(0);\n\n      if (enabled.value) {\n        if (disableCopy.value) return event.preventDefault();\n\n        if (textRange.toString().length >= COPYRIGHT_TRIGGER_WORDS) {\n          event.preventDefault();\n\n          const copyright = getCopyright();\n          const node = document.createElement(\"div\");\n\n          node.appendChild(selection.getRangeAt(0).cloneContents());\n\n          if (event.clipboardData) {\n            event.clipboardData.setData(\n              \"text/html\",\n              `${node.innerHTML}<hr><div class=\"copyright\">${copyright.replace(\n                /\\\\n/g,\n                \"<br>\"\n              )}</div>`\n            );\n            event.clipboardData.setData(\n              \"text/plain\",\n              `${\n                selection.getRangeAt(0).cloneContents().textContent || \"\"\n              }\\n------\\n${copyright}`\n            );\n          }\n        }\n      }\n    }\n  };\n\n  onMounted(() => {\n    const appElement = document.querySelector<HTMLDivElement>(\"#app\")!;\n\n    useEventListener(appElement, \"copy\", onCopy);\n\n    watchEffect(() => {\n      appElement.style.userSelect = disableSelection.value ? \"none\" : \"auto\";\n    });\n  });\n};\n","import { defineClientConfig } from \"@vuepress/client\";\n\nimport { setupCopyright } from \"./composables/index.js\";\n\nexport default defineClientConfig({\n  setup: () => {\n    setupCopyright();\n  },\n});\n"],"names":["canonical","setupCopyright","frontmatter","usePageFrontmatter","locale","useLocaleConfig","page","usePageData","enabled","computed","disableCopy","frontmatterOptions","isPlainObject","disableSelection","getCopyright","authorInfo","licenseInfo","author","license","link","removeEndingSlash","isLinkHttp","item","onCopy","event","selection","textRange","copyright","node","onMounted","appElement","useEventListener","watchEffect","defineClientConfig"],"mappings":"+VAoBA,MAAMA,EAAY,oBAELC,EAAiB,IAAY,CACxC,MAAMC,EAAcC,EAAAA,EACdC,EAASC,EAAgB,iBAAiB,EAC1CC,EAAOC,EAAqC,EAE5CC,EAAUC,EACd,IACE,EAAQP,EAAY,MAAM,MACzBA,EAAY,MAAM,OAAS,IAAS,gBACzC,EAEMQ,EAAcD,EAAS,IAAM,CACjC,MAAME,EAAqBT,EAAY,MAAM,KAE7C,OAAKM,EAAQ,MAGXI,EAAcD,CAAkB,GAChC,gBAAiBA,EAEVA,EAAmB,YAErB,uBARoB,EAS7B,CAAC,EAEKE,EAAmBJ,EAAS,IAAM,CACtC,MAAME,EAAqBT,EAAY,MAAM,KAE7C,OAAKM,EAAQ,MAGXI,EAAcD,CAAkB,GAChC,qBAAsBA,EAEfA,EAAmB,iBAErB,4BARoB,EAS7B,CAAC,EAEKG,EAAe,IAAc,CACjC,KAAM,CAAE,OAAQC,EAAa,GAAI,QAASC,EAAc,EAAG,EACzDV,EAAK,MAAM,UACP,CAAE,OAAAW,EAAQ,QAAAC,EAAS,KAAAC,CAAK,EAAIf,EAAO,MAEzC,MAAO,CACLW,EAAaE,EAAO,QAAQ,UAAWF,CAAU,EAAI,GACrDC,EAAcE,EAAQ,QAAQ,WAAYF,CAAW,EAAI,GACzDG,EAAK,QACH,QACAnB,EACI,GAAGoB,EACDC,EAAWrB,CAAS,EAAIA,EAAY,WAAWA,GACjD,IAAIM,EAAK,MAAM,OACf,OAAO,SAAS,IACtB,CACF,EACG,OAAQgB,GAASA,CAAI,EACrB,KAAK;AAAA,CAAI,CACd,EAEMC,EAAUC,GAAgC,CAC9C,MAAMC,EAAY,aAAA,EAElB,GAAIA,EAAW,CACb,MAAMC,EAAYD,EAAU,WAAW,CAAC,EAExC,GAAIjB,EAAQ,MAAO,CACjB,GAAIE,EAAY,MAAO,OAAOc,EAAM,iBAEpC,GAAIE,EAAU,WAAW,QAAU,wBAAyB,CAC1DF,EAAM,eAAA,EAEN,MAAMG,EAAYb,IACZc,EAAO,SAAS,cAAc,KAAK,EAEzCA,EAAK,YAAYH,EAAU,WAAW,CAAC,EAAE,eAAe,EAEpDD,EAAM,gBACRA,EAAM,cAAc,QAClB,YACA,GAAGI,EAAK,uCAAuCD,EAAU,QACvD,OACA,MACF,SACF,EACAH,EAAM,cAAc,QAClB,aACA,GACEC,EAAU,WAAW,CAAC,EAAE,gBAAgB,aAAe;AAAA;AAAA,EAC5CE,GACf,KAKV,EAEAE,EAAU,IAAM,CACd,MAAMC,EAAa,SAAS,cAA8B,MAAM,EAEhEC,EAAiBD,EAAY,OAAQP,CAAM,EAE3CS,EAAY,IAAM,CAChBF,EAAW,MAAM,WAAajB,EAAiB,MAAQ,OAAS,MAClE,CAAC,CACH,CAAC,CACH,EC5HA,IAAeoB,EAAAA,EAAmB,CAChC,MAAO,IAAM,CACXhC,EAAe,CACjB,CACF,CAAC"}